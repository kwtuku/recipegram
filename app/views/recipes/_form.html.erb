<%= form_with model: recipe, class: 'box p-6' do |f| %>
  <div class="field">
    <label class="label">画像</label>
    <p class='help has-text-dark mb-5'>2MB以下でjpgまたはjpeg、png、webp形式のファイルをアップロードすることができます。</p>

    <% if recipe.recipe_image.cached? %>
      <figure class="image is-400x400 mx-auto" id="file-preview-container">
        <%= image_tag "/#{recipe.recipe_image.cache_path}", class: 'is-400x400' %>
      </figure>
    <% elsif action == 'new' %>
      <figure class="image is-400x400 mx-auto is-hidden" id="file-preview-container"></figure>
    <% else %>
      <figure class="image is-400x400 mx-auto" id="file-preview-container">
        <%= image_tag recipe.recipe_image.thumb.url %>
      </figure>
    <% end %>

    <div class="file is-centered my-5">
      <%= f.label :recipe_image, class: 'file-label' do %>
        <%= f.file_field :recipe_image, class: 'file-input', required: action == 'new', accept: 'image/jpg, image/jpeg, image/png, image/webp' %>
        <span class="file-cta border_red_with_errors">
          <span class="file-icon">
            <i class="far fa-image"></i>
          </span>
          <span class="file-label">
            画像を選択する
          </span>
        </span>
      <% end %>
    </div>
    <%= render 'devise/shared/full_error_messages', model: recipe, attribute: :recipe_image %>
  </div>

  <div class="field">
    <%= f.label :title, class: 'label' %>
    <div class="control">
      <%= f.text_field :title, required: true, class: 'input' %>
    </div>
    <p class="help has-text-right">
      <span class="<%= 'has-text-danger' if recipe.errors[:title].any? %>" id="count-recipe-title-characters"><%= recipe.title&.size.presence || 0 %></span>/30字
    </p>
    <%= render 'devise/shared/full_error_messages', model: recipe, attribute: :title %>
  </div>

  <div class="field">
    <%= f.label :body, class: 'label' %>
    <div class="control">
      <%= f.text_area :body, required: true, class: 'textarea has-fixed-size resize-textarea js-resize-textarea' %>
    </div>
    <p class="help has-text-right">
      <span class="<%= 'has-text-danger' if recipe.errors[:body].any? %>" id="count-recipe-body-characters"><%= recipe.body&.size.presence || 0 %></span>/2000字
    </p>
    <%= render 'devise/shared/full_error_messages', model: recipe, attribute: :body %>
  </div>

  <div class="field">
    <%= f.label :tag_list, class: 'label' %>
    <div class="control" id="tag-input">
      <%= f.text_field :tag_list, value: f.object.tag_list.join(','), pattern: '^[,a-z0-9一-龠々ぁ-ヶー]+$', class: 'input custom-tagify-look' %>
    </div>
    <%= render 'devise/shared/full_error_messages', model: recipe, attribute: :tag_list %>
  </div>

  <% if action == 'new' %>
    <%= f.submit '投稿', class: 'button is-rounded is-info', id: 'create_recipe', disabled: true %>
  <% else %>
    <%= f.submit '更新', class: 'button is-rounded is-info', id: 'update_recipe', disabled: true %>
  <% end %>
<% end %>
